<form
  id="${field.formid}"
  class="deform ${field.css_class}"
  action="${field.action}"
  method="${field.method}"
  enctype="multipart/form-data"
  accept-charset="utf-8"
  tal:define="inline_form getattr(field,'inline_form',False);"
  i18n:domain="deform">

<fieldset>
 <legend tal:condition="field.title">${field.title}</legend>

    <input type="hidden" name="_charset_" />
    <input type="hidden" name="__formid__" value="${field.formid}"/>

    <div class="alert alert-block alert-error" tal:condition="field.error">
      <h4 i18n:translate="">There was a problem with your submission</h4>
      <span i18n:translate="">Errors have been highlighted below</span>
      <p>${field.errormsg}</p>
    </div>

    <div
      tal:define="rndr field.renderer;
                  tmpl field.widget.item_template"
        tal:repeat="f field.children"
        tal:replace="structure
                     rndr(tmpl,field=f,cstruct=cstruct.get(f.name, null), inline=inline_form)" />

    <fieldset class="form-actions" tal:omit-tag="inline_form">
      <tal:block repeat="button field.buttons">
        <button
            tal:attributes="disabled button.disabled"
            id="${field.formid+button.name}"
            name="${button.name}"
            type="${button.type}"
            class="btn ${repeat.button.start and 'btn-primary' or ''}"
            value="${button.value}">
          ${button.title}
        </button>
      </tal:block>
    </fieldset>

<script type="text/javascript" tal:condition="field.use_ajax">
  function deform_ajaxify(response, status, xhr, form, oid, mthd){
     var options = {
       target: '#' + oid,
       replaceTarget: true,
       success: function(response, status, xhr, form){
         deform_ajaxify(response, status, xhr, form, oid);
       }
     };
     var extra_options = ${field.ajax_options};
     var name;
     if (extra_options) {
       for (name in extra_options) {
         options[name] = extra_options[name];
       };
     };
     $('#' + oid).ajaxForm(options);
     if(mthd){
       mthd(response, status, xhr, form);
     }
  }
  deform.addCallback(
     '${field.formid}',
     function(oid) {
       deform_ajaxify(null, null, null, null, oid);
     }
  );
</script>
</fieldset>
</form>
